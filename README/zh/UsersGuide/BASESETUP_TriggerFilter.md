<!-- BASESETUP_TriggerFilter.md --- 
;; 
;; Description: 
;; Author: Hongyi Wu(吴鸿毅)
;; Email: wuhongyi@qq.com 
;; Created: 日 10月  7 09:35:24 2018 (+0800)
;; Last-Updated: 日 2月  3 15:35:37 2019 (+0800)
;;           By: Hongyi Wu(吴鸿毅)
;;     Update #: 16
;; URL: http://wuhongyi.cn -->

# Trigger Filter

<!-- toc -->

## GUI

![Trigger Filter](/img/TriggerFilter.png)


界面下方的 Status 显示为**绿色的 Ready** 时表示可操作该界面，否则需要等待。底下按钮的操作同上。

- 参数 *Rise Time* 表示触发滤波上升时间。
- 参数 *Flat Top* 表示触发滤波平顶时间。
- 参数 *Thresh.* 表示阈值，该数值的设置是相对 fast filter 波形。


以下为参数的一般经验：

 - 较长的触发滤波上升时间平均更多采样点，因此允许设置较低的阈值而不触发噪声。
 - 通常应将阈值设置得尽可能低，略高于噪声水平。
 - 较长的触发滤波平顶时间则可以更容易地触发缓慢的上升脉冲。

----

## 数字滤波

粒子能量探测器，包括诸如 Si（Li），HPGe，HgI2，CdTe 和 CZT 的固态探测器，通常采用电荷敏感前置放大器，如图所示。 这里，探测器**D**加偏置电压**V **，并连接到**前置放大器A**的输入端，后者具有反馈电容**Cf**和反馈电阻**Rf**。

![(a) Charge sensitive preamplifier with RC feedback; (b) Output on absorption of a gamma ray](/img/chargesenitivepreamplifierrcfeedbackoutputonabsorptionofagammaray.png)

通过滤波来降低测量中的噪声。传统的模拟电路使用微分电路和多个积分电路的组合将前置放大器输出步骤（如图（b）所示）转换为三角形或半高斯脉冲，其振幅（相对于基线）与 **Vx** 成比例，从而与伽马射线的能量成比例。

数字滤波从一个稍微不同的角度进行。这里的信号已经数字化，不再是连续的。相反，它是一个离散值字符串，如图所示。图实际上只是图（b）的一个子集，图中的信号由 Tektronix 544 TDS 数字示波器以 10 MSPS（每秒百万采样数）进行数字化。鉴于此数据集和某种算术处理器，确定VX的明显方法是对步骤前的点取某种平均值，然后从步骤后的点的平均值中减去它。也就是说，如图*数字版本的图（b）在阶跃区域*中的数据所示，在标记为“长度”的两个区域上计算平均值（“间隙”区域被省略，因为这里的信号变化很快），并将其差作为VX的度量。因此，Vx值可从以下方程式中得出：

数字滤波从一个稍微不同的角度进行。这里的信号已经数字化，不再是连续的。相反，它是一个离散值字符串，如图所示。图实际上只是图（b）的一个子集，图中的信号由 Tektronix 544 TDS 数字示波器以 10 MSPS（每秒百万采样数）进行数字化。鉴于此数据集和某种算术处理，确定**Vx**的明显方法是对当前处理点之前的点取某种平均值，然后从当前处理点之后点的平均值中减去它。也就是说，如下图中所示，计算标记为“Length”的两个区域的平均值（“Gap”区域被省略，因为这里的信号变化很快），并将其差作为**Vx**的度量。因此，**Vx**值可从以下方程式中得出：

$$V_{x,k}=-\sum_{i(before)}W_{i}V_{i}+\sum_{i(after)}W_{i}V_{i}$$

其中，加权常数**Wi**的值决定计算的平均值类型。两组权重的值之和必须单独归一化。

**不同数字信号处理算法之间的主要区别在于两个方面：使用哪组权重Wi以及如何选择区域来计算方程。**

因此，例如，当靠近当前处理点的区域使用较大的权重值，而远离当前处理点的数据使用较小的值时，方程式生成“尖点样”滤波。当权重值为常量时，将获得三角形（如果间隙为零）或梯形滤波。尖点滤波背后的概念是，由于最接近台阶的点携带了关于其高度的最多信息，因此它们在平均过程中应该是最强大的权重。如何选择滤波长度会导致时间变化（长度随脉冲变化）或时间不变（所有脉冲的长度相同）滤波。传统的模拟滤波是不随时间变化的。时变滤波背后的概念是，由于伽马射线随机到达，它们之间的长度也相应变化，因此可以通过将长度设置为脉冲间隔来最大限度地利用可用信息。

原则上，最佳过滤是通过使用尖点样权重(cusp-like weights)和时变滤波长度选择来完成的。然而，这种方法存在严重的成本问题，无论是在实时评估所需的总计算能力方面，还是在以脉冲为基础生成（通常由存储系数）归一化Wi集所需的电路的复杂性方面。

![Digitized version of the data of Figure (b) in the step region](/img/digitizedversionofthedataoffigurebinthestepregion.png)

**Pixie-16 采用了不同的方法，因为它针对高速处理进行了优化。**

它实现了一个固定长度的滤波算法，所有的*Wi**值均相等，实际上对每个新的信号值点 k 重新计算这个和。因此，所实现的方程是：

$$LV_{x,k}=-\sum_{i=k-2L-G+1}^{k-L-G}V_{i}+\sum_{i=k-L+1}^{k}V_{i}$$

其中过滤长度为**L**，间隙为**G**。系数**L**乘以$$V_{x,k}$$，因为这里的权重总和未归一化。适应这一因素是微不足道的。

虽然这种关系很简单，但仍然非常有效。首先，这是三角形（或梯形，如果g≠0）滤波的数字等价物，这是模拟行业的高速处理标准。第二，理论上可以证明，如果信号中的噪声在阶跃上下为白噪声（即高斯分布），这通常是用于高信号率处理的短整形时间的情况，那么方程中的平均值实际上在最小二乘意义上给出**Vx**的最佳估计。当然，这就是为什么三角过滤在高速率下更受欢迎的原因。

原则上，带时变滤波器长度的三角形滤波既可以获得较高的分辨率，也可以获得更高的吞吐量，但其代价是电路要复杂得多，并且与速率相关的分辨率，这对于许多类型的精确分析来说是不可接受的。在实践中，XIA 的设计可以复制最佳模拟整形器的能量分辨率，同时使其吞吐量增加一倍，这为该方法的有效性提供了实验验证。


<!-- BASESETUP_TriggerFilter.md ends here -->
